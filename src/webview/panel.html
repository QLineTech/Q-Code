<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Q-Code</title>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body class="bg-gray-100 min-h-screen p-4 font-sans antialiased text-gray-800">
    <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
        <h2 class="text-lg font-semibold text-gray-700 mb-4">Settings</h2>
        <form id="config-form" class="space-y-4">
            <div>
                <label for="api-key" class="block text-sm font-medium text-gray-600">API Key</label>
                <input type="text" id="api-key" name="api-key" value="${API_KEY}" class="mt-1 w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            </div>
            <button type="submit" class="w-full bg-indigo-600 text-white py-2 rounded-md hover:bg-indigo-700 transition-colors">Save</button>
        </form>

        <h2 class="text-lg font-semibold text-gray-700 mt-6 mb-4">Chat</h2>
        <div id="chat-display" class="h-64 overflow-y-auto bg-gray-50 p-4 rounded-md border border-gray-200 mb-4"></div>
        <div class="flex space-x-2">
            <input type="text" id="chat-input" placeholder="Type your message..." class="flex-1 px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent">
            <button id="chat-send" class="bg-indigo-600 text-white px-4 py-2 rounded-md hover:bg-indigo-700 transition-colors">Send</button>
        </div>
    </div>

    <script>
        const vscode = acquireVsCodeApi();
        document.getElementById('config-form').addEventListener('submit', (e) => {
            e.preventDefault();
            const apiKey = document.getElementById('api-key').value;
            vscode.postMessage({ type: 'setApiKey', apiKey: apiKey });
        });
        document.getElementById('chat-send').addEventListener('click', () => {
            const text = document.getElementById('chat-input').value;
            if (text) {
                const chatDisplay = document.getElementById('chat-display');
                chatDisplay.innerHTML += '<p class="mb-2"><span class="font-medium text-indigo-600">You:</span> ' + text + '</p>';
                chatDisplay.scrollTop = chatDisplay.scrollHeight;
                vscode.postMessage({ type: 'sendChatMessage', text: text });
                document.getElementById('chat-input').value = '';
            }
        });
        window.addEventListener('message', event => {
            const message = event.data;
            const chatDisplay = document.getElementById('chat-display');
            if (message.type === 'chatResponse') {
                chatDisplay.innerHTML += '<p class="mb-2"><span class="font-medium text-green-600">Grok3:</span> ' + message.text + '</p>';
            } else if (message.type === 'chatError') {
                chatDisplay.innerHTML += '<p class="mb-2 text-red-500">' + message.text + '</p>';
            }
            chatDisplay.scrollTop = chatDisplay.scrollHeight;
        });
    </script>
</body>
</html>